async function h(n){const t=new TextEncoder().encode(n),e=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(s=>s.toString(16).padStart(2,"0")).join("")}function y(n){const t=n.split("|");if(t.length!==5)return null;const[e,s,a,r,i]=t,o=Number(r);return!e||!s||!a||Number.isNaN(o)||!i?null:{ticketId:e,eventId:s,attendeeId:a,timestamp:o,hash:i}}async function E(n,t,e,s,a,r,i,o){const u=y(n);if(!u)return{status:"FAKE",message:"Malformed QR payload"};const{ticketId:c,eventId:d,attendeeId:l,timestamp:f,hash:m}=u;if(d!==e)return{status:"FAKE",message:"Ticket not for this event"};const g=Date.now();if(r&&g<r-120*1e3)return{status:"TOO_EARLY",message:"Event has not started"};const p=`${c}|${d}|${l}|${f}|${t}|`;return(await h(p)).slice(0,m.length)!==m?{status:"FAKE",message:"Invalid signature"}:s(c)?{status:"ALREADY_USED",message:"Ticket already used"}:(a(c),{status:"VALID",message:"Valid ticket"})}export{h as g,E as v};
