import{c as Y,r as l,u as lt,j as e,h as dt,l as W,i as ae,k as q,m as ge,B as F,A as ut,w as _,C as Ee,a as mt,e as ht,f as xt,b as je,g as _e,x as ft,y as pt,z as gt,G as jt,H as yt,J as vt,W as St}from"./index-Dtzn1OiH.js";import{I as se,L}from"./label-B2vF6gJm.js";import{i as wt,j as bt,k as Ve,a as Nt,u as kt,S as ie,b as oe,c as ce,d as le,e as C}from"./select-BKzTcHEH.js";import{T as Ct,a as Pt,b as De,c as Ae}from"./tabs-DDS5hEPl.js";import{S as Tt}from"./switch-IXMNHxS1.js";import{C as Mt,g as Et}from"./pdfGenerator-Cpbvt21B.js";import{s as _t}from"./client-rkYReKFa.js";import{g as Dt,a as At,c as Ie}from"./seasonal-CKgZBBys.js";import{M as ye}from"./map-pin-Ck1HRZQ4.js";import{C as Re}from"./calendar-D23VYtxI.js";import{S as It}from"./shield-CkgB0p1n.js";import{T as Fe}from"./ticket-DZ5RrBz6.js";import{P as Rt}from"./plus-DGPZRwVg.js";import"./security-CQiw_mJQ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Lt=Y("credit-card",Ft);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Le=Y("funnel",$t);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],$e=Y("info",Kt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M5 12h14",key:"1ays0h"}]],Vt=Y("minus",Bt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Ke=Y("search",zt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Ut=Y("star",Gt);var ze=["PageUp","PageDown"],Ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ue={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},X="Slider",[ve,Ht,Ot]=wt(X),[He]=dt(X,[Ot]),[Wt,de]=He(X),Oe=l.forwardRef((t,a)=>{const{name:r,min:s=0,max:i=100,step:u=1,orientation:d="horizontal",disabled:o=!1,minStepsBetweenThumbs:h=0,defaultValue:b=[s],value:N,onValueChange:c=()=>{},onValueCommit:x=()=>{},inverted:v=!1,form:M,...f}=t,S=l.useRef(new Set),p=l.useRef(0),k=d==="horizontal"?Yt:qt,[w=[],D]=lt({prop:N,defaultProp:b,onChange:P=>{[...S.current][p.current]?.focus(),c(P)}}),J=l.useRef(w);function $(P){const A=es(w,P);K(P,A)}function ue(P){K(P,p.current)}function z(){const P=J.current[p.current];w[p.current]!==P&&x(w)}function K(P,A,{commit:Z}={commit:!1}){const Q=ns(u),ee=rs(Math.round((P-s)/u)*u+s,Q),G=Ve(ee,[s,i]);D((U=[])=>{const T=Zt(U,G,A);if(as(T,h*u)){p.current=T.indexOf(G);const ne=String(T)!==String(U);return ne&&Z&&x(T),ne?T:U}else return U})}return e.jsx(Wt,{scope:t.__scopeSlider,name:r,disabled:o,min:s,max:i,valueIndexToChangeRef:p,thumbs:S.current,values:w,orientation:d,form:M,children:e.jsx(ve.Provider,{scope:t.__scopeSlider,children:e.jsx(ve.Slot,{scope:t.__scopeSlider,children:e.jsx(k,{"aria-disabled":o,"data-disabled":o?"":void 0,...f,ref:a,onPointerDown:W(f.onPointerDown,()=>{o||(J.current=w)}),min:s,max:i,inverted:v,onSlideStart:o?void 0:$,onSlideMove:o?void 0:ue,onSlideEnd:o?void 0:z,onHomeKeyDown:()=>!o&&K(s,0,{commit:!0}),onEndKeyDown:()=>!o&&K(i,w.length-1,{commit:!0}),onStepKeyDown:({event:P,direction:A})=>{if(!o){const ee=ze.includes(P.key)||P.shiftKey&&Ge.includes(P.key)?10:1,G=p.current,U=w[G],T=u*ee*A;K(U+T,G,{commit:!0})}}})})})})});Oe.displayName=X;var[We,Ye]=He(X,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Yt=l.forwardRef((t,a)=>{const{min:r,max:s,dir:i,inverted:u,onSlideStart:d,onSlideMove:o,onSlideEnd:h,onStepKeyDown:b,...N}=t,[c,x]=l.useState(null),v=q(a,k=>x(k)),M=l.useRef(void 0),f=bt(i),S=f==="ltr",p=S&&!u||!S&&u;function V(k){const w=M.current||c.getBoundingClientRect(),D=[0,w.width],$=be(D,p?[r,s]:[s,r]);return M.current=w,$(k-w.left)}return e.jsx(We,{scope:t.__scopeSlider,startEdge:p?"left":"right",endEdge:p?"right":"left",direction:p?1:-1,size:"width",children:e.jsx(qe,{dir:f,"data-orientation":"horizontal",...N,ref:v,style:{...N.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:k=>{const w=V(k.clientX);d?.(w)},onSlideMove:k=>{const w=V(k.clientX);o?.(w)},onSlideEnd:()=>{M.current=void 0,h?.()},onStepKeyDown:k=>{const D=Ue[p?"from-left":"from-right"].includes(k.key);b?.({event:k,direction:D?-1:1})}})})}),qt=l.forwardRef((t,a)=>{const{min:r,max:s,inverted:i,onSlideStart:u,onSlideMove:d,onSlideEnd:o,onStepKeyDown:h,...b}=t,N=l.useRef(null),c=q(a,N),x=l.useRef(void 0),v=!i;function M(f){const S=x.current||N.current.getBoundingClientRect(),p=[0,S.height],k=be(p,v?[s,r]:[r,s]);return x.current=S,k(f-S.top)}return e.jsx(We,{scope:t.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:e.jsx(qe,{"data-orientation":"vertical",...b,ref:c,style:{...b.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const S=M(f.clientY);u?.(S)},onSlideMove:f=>{const S=M(f.clientY);d?.(S)},onSlideEnd:()=>{x.current=void 0,o?.()},onStepKeyDown:f=>{const p=Ue[v?"from-bottom":"from-top"].includes(f.key);h?.({event:f,direction:p?-1:1})}})})}),qe=l.forwardRef((t,a)=>{const{__scopeSlider:r,onSlideStart:s,onSlideMove:i,onSlideEnd:u,onHomeKeyDown:d,onEndKeyDown:o,onStepKeyDown:h,...b}=t,N=de(X,r);return e.jsx(ae.span,{...b,ref:a,onKeyDown:W(t.onKeyDown,c=>{c.key==="Home"?(d(c),c.preventDefault()):c.key==="End"?(o(c),c.preventDefault()):ze.concat(Ge).includes(c.key)&&(h(c),c.preventDefault())}),onPointerDown:W(t.onPointerDown,c=>{const x=c.target;x.setPointerCapture(c.pointerId),c.preventDefault(),N.thumbs.has(x)?x.focus():s(c)}),onPointerMove:W(t.onPointerMove,c=>{c.target.hasPointerCapture(c.pointerId)&&i(c)}),onPointerUp:W(t.onPointerUp,c=>{const x=c.target;x.hasPointerCapture(c.pointerId)&&(x.releasePointerCapture(c.pointerId),u(c))})})}),Xe="SliderTrack",Je=l.forwardRef((t,a)=>{const{__scopeSlider:r,...s}=t,i=de(Xe,r);return e.jsx(ae.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...s,ref:a})});Je.displayName=Xe;var Se="SliderRange",Ze=l.forwardRef((t,a)=>{const{__scopeSlider:r,...s}=t,i=de(Se,r),u=Ye(Se,r),d=l.useRef(null),o=q(a,d),h=i.values.length,b=i.values.map(x=>tt(x,i.min,i.max)),N=h>1?Math.min(...b):0,c=100-Math.max(...b);return e.jsx(ae.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...s,ref:o,style:{...t.style,[u.startEdge]:N+"%",[u.endEdge]:c+"%"}})});Ze.displayName=Se;var we="SliderThumb",Qe=l.forwardRef((t,a)=>{const r=Ht(t.__scopeSlider),[s,i]=l.useState(null),u=q(a,o=>i(o)),d=l.useMemo(()=>s?r().findIndex(o=>o.ref.current===s):-1,[r,s]);return e.jsx(Xt,{...t,ref:u,index:d})}),Xt=l.forwardRef((t,a)=>{const{__scopeSlider:r,index:s,name:i,...u}=t,d=de(we,r),o=Ye(we,r),[h,b]=l.useState(null),N=q(a,V=>b(V)),c=h?d.form||!!h.closest("form"):!0,x=Nt(h),v=d.values[s],M=v===void 0?0:tt(v,d.min,d.max),f=Qt(s,d.values.length),S=x?.[o.size],p=S?ts(S,M,o.direction):0;return l.useEffect(()=>{if(h)return d.thumbs.add(h),()=>{d.thumbs.delete(h)}},[h,d.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[o.startEdge]:`calc(${M}% + ${p}px)`},children:[e.jsx(ve.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(ae.span,{role:"slider","aria-label":t["aria-label"]||f,"aria-valuemin":d.min,"aria-valuenow":v,"aria-valuemax":d.max,"aria-orientation":d.orientation,"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,tabIndex:d.disabled?void 0:0,...u,ref:N,style:v===void 0?{display:"none"}:t.style,onFocus:W(t.onFocus,()=>{d.valueIndexToChangeRef.current=s})})}),c&&e.jsx(et,{name:i??(d.name?d.name+(d.values.length>1?"[]":""):void 0),form:d.form,value:v},s)]})});Qe.displayName=we;var Jt="RadioBubbleInput",et=l.forwardRef(({__scopeSlider:t,value:a,...r},s)=>{const i=l.useRef(null),u=q(i,s),d=kt(a);return l.useEffect(()=>{const o=i.current;if(!o)return;const h=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(h,"value").set;if(d!==a&&N){const c=new Event("input",{bubbles:!0});N.call(o,a),o.dispatchEvent(c)}},[d,a]),e.jsx(ae.input,{style:{display:"none"},...r,ref:u,defaultValue:a})});et.displayName=Jt;function Zt(t=[],a,r){const s=[...t];return s[r]=a,s.sort((i,u)=>i-u)}function tt(t,a,r){const u=100/(r-a)*(t-a);return Ve(u,[0,100])}function Qt(t,a){return a>2?`Value ${t+1} of ${a}`:a===2?["Minimum","Maximum"][t]:void 0}function es(t,a){if(t.length===1)return 0;const r=t.map(i=>Math.abs(i-a)),s=Math.min(...r);return r.indexOf(s)}function ts(t,a,r){const s=t/2,u=be([0,50],[0,s]);return(s-u(a)*r)*r}function ss(t){return t.slice(0,-1).map((a,r)=>t[r+1]-a)}function as(t,a){if(a>0){const r=ss(t);return Math.min(...r)>=a}return!0}function be(t,a){return r=>{if(t[0]===t[1]||a[0]===a[1])return a[0];const s=(a[1]-a[0])/(t[1]-t[0]);return a[0]+s*(r-t[0])}}function ns(t){return(String(t).split(".")[1]||"").length}function rs(t,a){const r=Math.pow(10,a);return Math.round(t*r)/r}var is=Oe,os=Je,cs=Ze,ls=Qe;function ds({className:t,defaultValue:a,value:r,min:s=0,max:i=100,...u}){const d=l.useMemo(()=>Array.isArray(r)?r:Array.isArray(a)?a:[s,i],[r,a,s,i]);return e.jsxs(is,{"data-slot":"slider",defaultValue:a,value:r,min:s,max:i,className:ge("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...u,children:[e.jsx(os,{"data-slot":"slider-track",className:ge("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(cs,{"data-slot":"slider-range",className:ge("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:d.length},(o,h)=>e.jsx(ls,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},h))]})}const st={};async function at(t){return new Promise((a,r)=>{if(document.querySelector(`script[src="${t}"]`)){a();return}const s=document.createElement("script");s.src=t,s.async=!0,s.onload=()=>a(),s.onerror=()=>r(new Error(`Failed to load script ${t}`)),document.head.appendChild(s)})}async function us(t){const a=st?.VITE_PAYSTACK_PUBLIC_KEY;if(!a)return{ok:!1,error:"Missing Paystack public key (VITE_PAYSTACK_PUBLIC_KEY)."};await at("https://js.paystack.co/v1/inline.js");const r=t.reference??`GP-${Date.now()}`,s=window.PaystackPop?.setup?.({key:a,email:t.email,amount:Math.round(t.amount*100),currency:t.currency??"NGN",ref:r,metadata:t.metadata,callback:i=>{t.onSuccess?.(i)},onClose:()=>{t.onCancel?.()}});return s?(s.openIframe(),{ok:!0}):{ok:!1,error:"Paystack inline SDK not available."}}async function ms(t){const a=st?.VITE_FLUTTERWAVE_PUBLIC_KEY;if(!a)return{ok:!1,error:"Missing Flutterwave public key (VITE_FLUTTERWAVE_PUBLIC_KEY)."};await at("https://checkout.flutterwave.com/v3.js");const r=t.reference??`GP-${Date.now()}`,s=window.FlutterwaveCheckout;return s?(s({public_key:a,tx_ref:r,amount:t.amount,currency:t.currency??"NGN",customer:{email:t.email,phone_number:t.phone??"",name:t.name??""},callback:i=>{t.onSuccess?.(i)},onclose:()=>{t.onCancel?.()}}),{ok:!0}):{ok:!1,error:"Flutterwave checkout SDK not available."}}async function hs(){return{ok:!1,error:"M-Pesa STK Push requires a server endpoint. Configure server-side integration."}}const Be=[{id:1,title:"Tech Conference 2024",description:"Join industry leaders for cutting-edge tech talks and networking.",date:"2024-03-15",time:"09:00 AM - 06:00 PM",venue:"Convention Center, SF",category:"Technology",niche:"AI",location:{city:"San Francisco",lat:37.784,lng:-122.401},price:150,image:"/api/placeholder/400/250",organizer:"TechEvents Inc",attendees:450,maxCapacity:500,rating:4.8,verified:!0,ticketTiers:[{id:1,name:"Early Bird",price:120,available:50,description:"Limited time offer"},{id:2,name:"General",price:150,available:200,description:"Standard admission"},{id:3,name:"VIP",price:300,available:25,description:"Premium access + networking"}]},{id:2,title:"Music Festival Summer",description:"Three days of amazing music with top artists from around the world.",date:"2024-06-20",time:"12:00 PM - 11:00 PM",venue:"Golden Gate Park",category:"Music",niche:"Festival",location:{city:"San Francisco",lat:37.7694,lng:-122.4862},price:120,image:"/api/placeholder/400/250",organizer:"Summer Sounds",attendees:8500,maxCapacity:1e4,rating:4.9,verified:!0,ticketTiers:[{id:1,name:"General Admission",price:120,available:1500,description:"Access to all stages"},{id:2,name:"VIP Experience",price:350,available:200,description:"Front row + backstage access"}]},{id:3,title:"Startup Pitch Night",description:"Watch innovative startups pitch their ideas to investors.",date:"2024-02-28",time:"06:00 PM - 09:00 PM",venue:"WeWork Downtown",category:"Business",niche:"Startup",location:{city:"San Francisco",lat:37.788,lng:-122.402},price:30,image:"/api/placeholder/400/250",organizer:"Startup Hub",attendees:85,maxCapacity:100,rating:4.7,verified:!0,ticketTiers:[{id:1,name:"Standard",price:30,available:15,description:"General seating"}]}];function Ts({eventId:t,onBack:a,onPurchaseComplete:r}){const[s,i]=l.useState(null),[u,d]=l.useState(""),[o,h]=l.useState(1),[b,N]=l.useState("crypto"),[c,x]=l.useState("none"),[v,M]=l.useState("NGN"),[f,S]=l.useState(""),[p,V]=l.useState(""),[k,w]=l.useState(!1),[D,J]=l.useState(0),[$,ue]=l.useState(0),z=Dt(),[K,P]=l.useState(At()||""),[A,Z]=l.useState(""),[Q,ee]=l.useState("all"),[G,U]=l.useState("all"),[T,ne]=l.useState(null),[me,nt]=l.useState(0),[Ne,R]=l.useState(!1),rt=Array.from(new Set(Be.map(n=>n.niche))).sort();function re(n){return n*Math.PI/180}function ke(n,m){const E=re(m.lat-n.lat),I=re(m.lng-n.lng),B=re(n.lat),y=re(m.lat),g=Math.sin(E/2),te=Math.sin(I/2);return 6371*(2*Math.asin(Math.sqrt(g*g+Math.cos(B)*Math.cos(y)*te*te)))}const Ce=Be.filter(n=>{const m=n.title.toLowerCase().includes(A.toLowerCase())||n.description.toLowerCase().includes(A.toLowerCase()),j=Q==="all"||n.category===Q,E=G==="all"||n.niche===G,I=!T||me===0?!0:ke(T,{lat:n.location.lat,lng:n.location.lng})<=me;return m&&j&&E&&I}),it=async()=>{if(!s||!u)return;R(!0);const n=s.ticketTiers.find(y=>y.id.toString()===u),m=Pe,j=m*.025,E=Ie(m,z,K),I=n&&o>=10?n.price*2:0,B=Math.max(0,m+j-E-I+D+$);try{if(b==="fiat"){if(c==="paystack"){const y=await us({email:f||"buyer@example.com",amount:Number(B.toFixed(2)),currency:v,reference:`GP-${s.id}-${Date.now()}`,metadata:{eventId:s.id,tierId:u},onSuccess:async()=>{await he(s,n)},onCancel:()=>{_.info("Payment canceled."),R(!1)}});y.ok||(_.error(y.error||"Unable to start Paystack checkout."),R(!1));return}if(c==="flutterwave"){const y=await ms({email:f||"buyer@example.com",amount:Number(B.toFixed(2)),currency:v,phone:p||void 0,name:f?f.split("@")[0]:"Attendee",reference:`GP-${s.id}-${Date.now()}`,onSuccess:async()=>{await he(s,n)},onCancel:()=>{_.info("Payment canceled."),R(!1)}});y.ok||(_.error(y.error||"Unable to start Flutterwave checkout."),R(!1));return}if(c==="mpesa"){const y=await hs();_.error(y.error||"M-Pesa not configured."),R(!1);return}if(c==="stripe"){_.error("Stripe not configured."),R(!1);return}_.error("Please select a local payment gateway."),R(!1);return}await new Promise(y=>setTimeout(y,1500)),await he(s,n)}catch(y){console.error("Purchase error:",y),_.error("Purchase failed. Please try again."),R(!1)}};async function he(n,m){_.success("Ticket purchased successfully!",{description:"Your NFT ticket has been minted to your wallet."});try{const j=document.createElement("div");j.style.position="fixed",j.style.inset="0",j.style.pointerEvents="none",j.style.zIndex="1000",document.body.appendChild(j);const E=["#FFD166","#06D6A0","#EF476F","#118AB2","#8338EC"],I=Array.from({length:140},(B,y)=>{const g=document.createElement("div");g.style.position="absolute",g.style.width=Math.round(Math.random()*6+4)+"px",g.style.height=Math.round(Math.random()*12+6)+"px",g.style.background=E[y%E.length],g.style.left=Math.round(Math.random()*100)+"%",g.style.top="-20px",g.style.opacity="0.9",g.style.transform=`rotate(${Math.round(Math.random()*360)}deg)`,j.appendChild(g);const te=Math.random()*1200+1600,Me=(Math.random()*2-1)*120,ct=[{transform:g.style.transform,top:"-20px"},{transform:`translate(${Me}px, 0px) rotate(${Math.round(Math.random()*360)}deg)`,top:"100vh"}];return g.animate(ct,{duration:te,easing:"cubic-bezier(0.22, 1, 0.36, 1)",fill:"forwards"}),setTimeout(()=>{g.remove()},te+200),g});setTimeout(()=>{j.remove()},2400)}catch{}try{try{const{data:j}=await _t.auth.getSession(),E=j?.session?.access_token;if(E&&m){const I=await fetch("/make-server-f7f2fbf2/tickets/purchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({eventId:String(n.id),tierId:String(m.id),quantity:o,paymentMethod:b})});if(!I.ok){const B=await I.text();console.warn("Server purchase record failed:",B)}}}catch(j){console.warn("Skipping server purchase recording:",j)}if(m){const j={eventId:String(n.id),attendeeId:"demo-attendee",ticketType:m.name,event:{name:n.title,dateISO:n.date,time:n.time,venue:n.venue,bannerUrl:void 0},attendee:{name:f?f.split("@")[0]:"Attendee"},purchaseTimestamp:Date.now(),blockchain:{chain:"polygon",txHash:"0xDEMO"},secretSalt:"demo-salt"},{ticketId:E,pdfBytes:I}=await Et(j),B=new Blob([new Uint8Array(I)],{type:"application/pdf"}),y=URL.createObjectURL(B),g=document.createElement("a");g.href=y,g.download=`GatePass_Ticket_${E}.pdf`,document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(y)}}catch(j){console.error("PDF generation error:",j),_.error("Ticket generated, but download failed.")}R(!1),i(null),d(""),h(1),r()}const H=s?.ticketTiers.find(n=>n.id.toString()===u),Pe=H?H.price*o:0,xe=Pe,Te=xe*.025,fe=Ie(xe,z,K),pe=H&&o>=10?H.price*2:0,ot=Math.max(0,xe+Te-fe-pe),O=Math.max(0,ot+D+$);return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[e.jsxs(F,{variant:"ghost",onClick:a,className:"flex items-center space-x-2",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Browse Events"}),e.jsx("p",{className:"text-muted-foreground",children:"Find and purchase tickets for upcoming events"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"Search events...",value:A,onChange:n=>Z(n.target.value),className:"pl-10"})]})}),e.jsxs(ie,{onValueChange:ee,children:[e.jsxs(oe,{children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),e.jsx(ce,{placeholder:"All Categories"})]}),e.jsxs(le,{children:[e.jsx(C,{value:"all",children:"All Categories"}),e.jsx(C,{value:"Technology",children:"Technology"}),e.jsx(C,{value:"Music",children:"Music"}),e.jsx(C,{value:"Business",children:"Business"}),e.jsx(C,{value:"Art",children:"Art"}),e.jsx(C,{value:"Sports",children:"Sports"})]})]}),e.jsxs(ie,{onValueChange:U,children:[e.jsxs(oe,{children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),e.jsx(ce,{placeholder:"All Niches"})]}),e.jsxs(le,{children:[e.jsx(C,{value:"all",children:"All Niches"}),rt.map(n=>e.jsx(C,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsx(F,{variant:"outline",onClick:()=>{if(!("geolocation"in navigator)){_.error("Geolocation not supported in this browser.");return}navigator.geolocation.getCurrentPosition(n=>{ne({lat:n.coords.latitude,lng:n.coords.longitude}),_.success("Location synced. Showing nearby events.")},n=>{console.error("Geolocation error:",n),_.error("Unable to fetch location. Please allow access.")},{enableHighAccuracy:!0,timeout:1e4})},children:"Use My Location"}),e.jsxs(ie,{onValueChange:n=>nt(Number(n)),children:[e.jsxs(oe,{children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),e.jsx(ce,{placeholder:"Any distance"})]}),e.jsxs(le,{children:[e.jsx(C,{value:String(0),children:"Any distance"}),e.jsx(C,{value:String(5),children:"Within 5 km"}),e.jsx(C,{value:String(10),children:"Within 10 km"}),e.jsx(C,{value:String(25),children:"Within 25 km"}),e.jsx(C,{value:String(50),children:"Within 50 km"})]})]}),T&&e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Location set. Filtering within ",me||"any"," km."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ce.map(n=>e.jsxs(Ee,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsx("div",{className:"aspect-video bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center",children:e.jsx(Re,{className:"h-16 w-16 text-primary/50"})}),e.jsx(mt,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ht,{className:"text-lg line-clamp-1",children:n.title}),e.jsx(xt,{className:"line-clamp-2",children:n.description})]}),n.verified&&e.jsxs(je,{variant:"outline",className:"ml-2",children:[e.jsx(It,{className:"h-3 w-3 mr-1"}),"Verified"]})]})}),e.jsxs(_e,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:n.date})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:n.time})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"line-clamp-1",children:[n.venue,T?` • ${n.location.city}`:""]})]}),T&&e.jsxs("div",{className:"text-xs text-muted-foreground pl-6",children:["~",Math.round(ke(T,{lat:n.location.lat,lng:n.location.lng}))," km away"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-yellow-500 fill-current"}),e.jsx("span",{className:"text-sm",children:n.rating}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",n.attendees,")"]})]}),e.jsxs(je,{variant:"secondary",children:[n.category," • ",n.niche]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"From"}),e.jsxs("p",{className:"font-bold",children:["$",Math.min(...n.ticketTiers.map(m=>m.price))]})]}),e.jsxs(ft,{children:[e.jsx(pt,{asChild:!0,children:e.jsx(F,{onClick:()=>i(n),children:"Buy Tickets"})}),e.jsxs(gt,{className:"max-w-2xl",children:[e.jsxs(jt,{children:[e.jsxs(yt,{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),e.jsx("span",{children:"Purchase Tickets"})]}),e.jsxs(vt,{children:[s?.title," • ",s?.date]})]}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-base font-medium",children:"Select Ticket Type"}),e.jsx("div",{className:"grid gap-3 mt-2",children:s.ticketTiers.map(m=>e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${u===m.id.toString()?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>d(m.id.toString()),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:m.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["$",m.price]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.available," left"]})]})]})},m.id))})]}),u&&e.jsxs("div",{children:[e.jsx(L,{className:"text-base font-medium",children:"Quantity"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>h(Math.max(1,o-1)),disabled:o<=1,children:e.jsx(Vt,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-12 text-center",children:o}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>h(Math.min(12,o+1)),disabled:o>=12||H&&o>=H.available,children:e.jsx(Rt,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Group discount applies at 10+ tickets"})]}),u&&e.jsxs("div",{children:[e.jsx(L,{className:"text-base font-medium",children:"Payment Method"}),e.jsxs(Ct,{value:b,onValueChange:m=>N(m),className:"mt-2",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"crypto",className:"flex items-center space-x-2",children:[e.jsx(St,{className:"h-4 w-4"}),e.jsx("span",{children:"Crypto"})]}),e.jsxs(De,{value:"fiat",className:"flex items-center space-x-2",children:[e.jsx(Lt,{className:"h-4 w-4"}),e.jsx("span",{children:"Credit Card"})]})]}),e.jsx(Ae,{value:"crypto",className:"space-y-3",children:e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($e,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"Crypto Payment"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pay with ETH, MATIC, or USDC. Tickets are minted as NFTs directly to your wallet."})]})}),e.jsx(Ae,{value:"fiat",className:"space-y-3",children:e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($e,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"Local Currency Payment"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pay with Paystack or Flutterwave in NGN, GHS, KES, or ZAR. If M-Pesa is selected, a server configuration is required."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Currency"}),e.jsxs(ie,{value:v,onValueChange:m=>M(m),children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Select currency"})}),e.jsxs(le,{children:[e.jsx(C,{value:"NGN",children:"NGN (₦)"}),e.jsx(C,{value:"GHS",children:"GHS (₵)"}),e.jsx(C,{value:"KES",children:"KES (KSh)"}),e.jsx(C,{value:"ZAR",children:"ZAR (R)"})]})]})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Email"}),e.jsx(se,{placeholder:"you@example.com",value:f,onChange:m=>S(m.target.value)})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Phone (optional)"}),e.jsx(se,{placeholder:"e.g. 0803 123 4567",value:p,onChange:m=>V(m.target.value)})]})]}),z&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(L,{className:"text-sm",children:"Promo Code"}),e.jsx(se,{placeholder:z.code,value:K,onChange:m=>P(m.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(je,{variant:"secondary",className:"w-full justify-center",children:[z.name," - ",z.discountPercent,"% off"]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-3",children:[e.jsx(F,{type:"button",variant:c==="paystack"?"default":"outline",onClick:()=>x("paystack"),children:"Paystack"}),e.jsx(F,{type:"button",variant:c==="flutterwave"?"default":"outline",onClick:()=>x("flutterwave"),children:"Flutterwave"}),e.jsx(F,{type:"button",variant:c==="mpesa"?"default":"outline",onClick:()=>x("mpesa"),children:"M-Pesa"}),e.jsx(F,{type:"button",variant:c==="stripe"?"default":"outline",onClick:()=>x("stripe"),children:"Stripe"})]})]})})]})]}),u&&e.jsxs("div",{className:"border rounded-lg p-4 bg-muted/30",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[H?.name," × ",o]}),e.jsxs("span",{children:["$",(H?.price||0)*o]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Platform fee"}),e.jsxs("span",{children:["$",Te.toFixed(2)]})]}),fe>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Promo discount"}),e.jsxs("span",{children:["- $",fe.toFixed(2)]})]}),pe>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Group discount"}),e.jsxs("span",{children:["- $",pe.toFixed(2)]})]}),D>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Donation"}),e.jsxs("span",{children:["+ $",D.toFixed(2)]})]}),$>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tip"}),e.jsxs("span",{children:["+ $",$.toFixed(2)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-medium",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",O.toFixed(2)]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Enable Installments"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Tt,{checked:k,onCheckedChange:w}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Pay in 4"})]}),k&&e.jsxs("div",{className:"text-xs mt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Now"}),e.jsxs("span",{children:["$",(O/4).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"In 30 days"}),e.jsxs("span",{children:["$",(O/4).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"In 60 days"}),e.jsxs("span",{children:["$",(O/4).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"In 90 days"}),e.jsxs("span",{children:["$",(O/4).toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Donation"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(ds,{value:[D],onValueChange:m=>J(Number(m[0]||0)),max:100,step:1}),e.jsxs("div",{className:"text-xs mt-1",children:["$",D.toFixed(0)]})]}),e.jsx(L,{className:"text-sm mt-3",children:"Tip"}),e.jsx(se,{type:"number",value:$,onChange:m=>ue(Number(m.target.value||0)),placeholder:"$0"})]})]})]}),e.jsx(F,{onClick:it,disabled:!u||Ne,className:"w-full flex items-center space-x-2",children:Ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Purchase Tickets — $",O.toFixed(2)]})]})})]})]})]})]})]})]},n.id))}),Ce.length===0&&e.jsx(Ee,{children:e.jsxs(_e,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ke,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Events Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"Try adjusting your search criteria or browse all categories."})]})})]})})}export{Ts as TicketPurchase};
